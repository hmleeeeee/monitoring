<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tension Monitoring | 대시보드</title>

  <link href="css/bootstrap.min.css" rel="stylesheet">
  <link href="font-awesome/css/font-awesome.css" rel="stylesheet">
  <link href="css/plugins/toastr/toastr.min.css" rel="stylesheet">
  <link href="css/animate.css" rel="stylesheet">
  <link href="css/style.css" rel="stylesheet">
</head>
<body class="top-navigation has-dashboard" data-theme="light"> <!-- (has-dashboard) 클래스 필요 -->
  <!-- body[data-theme] = "light" | "dark" 로 테마를 관리 -->
  <div id="wrapper">
    <div id="page-wrapper">
      <div class="row border-bottom navy-bg">
        <nav class="navbar navbar-expand-lg navbar-static-top" role="navigation">
          <div class="navbar-header">
            <a href="#" class="navbar-brand">logo</a>
          </div>
          <div class="navbar-collapse collapse" id="navbar">
            <ul class="nav navbar-nav mr-auto">
              <li class="dropdown">
                <a role="button" href="#" class="dropdown-toggle" data-toggle="dropdown">도메인 관리</a>
                <ul class="dropdown-menu">
                  <li><a href="">도메인 메뉴1</a></li>
                  <li><a href="">도메인 메뉴2</a></li>
                  <li><a href="">도메인 메뉴3</a></li>
                  <li><a href="">도메인 메뉴4</a></li>
                </ul>
              </li>
              <li class="dropdown">
                <a role="button" href="#" class="dropdown-toggle" data-toggle="dropdown">사이트 관리</a>
                <ul class="dropdown-menu">
                  <li><a href="">사이트 메뉴1</a></li>
                  <li><a href="">사이트 메뉴2</a></li>
                  <li><a href="">사이트 메뉴3</a></li>
                  <li><a href="">사이트 메뉴4</a></li>
                </ul>
              </li>
              <li class="dropdown">
                <a role="button" href="#" class="dropdown-toggle" data-toggle="dropdown">노드 관리</a>
                <ul class="dropdown-menu">
                  <li><a href="">노드 메뉴1</a></li>
                  <li><a href="">노드 메뉴2</a></li>
                  <li><a href="">노드 메뉴3</a></li>
                  <li><a href="">노드 메뉴4</a></li>
                  <li><a href="">노드 메뉴5</a></li>
                </ul>
              </li>
              <li class="dropdown">
                <a role="button" href="#" class="dropdown-toggle" data-toggle="dropdown">센서 관리</a>
                <ul class="dropdown-menu">
                  <li><a href="">센서 메뉴1</a></li>
                  <li><a href="">센서 메뉴2</a></li>
                  <li><a href="">센서 메뉴3</a></li>
                  <li><a href="">센서 메뉴4</a></li>
                </ul>
              </li>
              <li class="dropdown">
                <a role="button" href="#" class="dropdown-toggle" data-toggle="dropdown">설정</a>
                <ul class="dropdown-menu">
                  <li><a href="">사용자 관리</a></li>
                  <li><a href="">센서 모니터링</a></li>
                  <li><a href="">대시보드1</a></li>
                  <li><a href="">대시보드2</a></li>
                </ul>
              </li>
            </ul>
            <ul class="nav navbar-top-links navbar-right">
              <li>
                <a href="LO0001.html"><i class="fa fa-sign-out"></i> Log out</a>
              </li>
            </ul>
          </div>
        </nav>
      </div>

      <div class="tmd-wrap">
        <div class="tmd-header tmd-header--bar">
          <h2 class="tmd-title">Tension Monitoring Dashboard</h2>
          <div class="tmd-clock" id="tmd-clock" aria-live="polite">09:00 AM</div>
          <div class="tmd-toolbar">
            <button type="button" id="tmd-theme-toggle" class="tmd-btn" aria-pressed="false" aria-label="테마 전환">
              <i class="fa fa-moon-o" aria-hidden="true"></i><span class="sr-only">Light / Dark</span>
            </button>
          </div>
        </div>

        <div class="tmd-layout">
          <div class="tmd-list" id="tmd-list">
            <div class="tmd-card" data-line="부산역 - 사하">
              <div class="tmd-label tmd-from">출발</div>
              <div class="tmd-route">
                <div class="tmd-track">
                  <div class="tmd-grid">
                      <div class="tmd-row">
                        <!--
                        상태 구분: unknown|ok|warn|danger (미수신|정상|주의|위험)
                        상태 적용: .tmd-dotbtn, .tmd-edge (클래스로 상태 표현)
                        tmd-edge data: data-state, data-from, data-to, data-line (팝오버/로그 메타)
                        마지막 노드엔 (tmd-pair--last) 클래스 추가
                        -->
                        <div class="tmd-pair">
                          <div class="tmd-node">
                            <button type="button" class="tmd-dotbtn unknown" aria-pressed="false"></button>
                            <span class="tmd-nlabel">부산역</span>
                          </div>
                          <div class="tmd-edge unknown" data-state="unknown" data-from="부산역" data-to="중앙" data-line="부산역 - 사하"></div>
                        </div>
                
                        <div class="tmd-pair">
                          <div class="tmd-node">
                            <button type="button" class="tmd-dotbtn unknown" aria-pressed="false"></button>
                            <span class="tmd-nlabel">중앙</span>
                          </div>
                          <div class="tmd-edge ok" data-state="ok" data-from="중앙" data-to="남포" data-line="부산역 - 사하"></div>
                        </div>
                
                        <div class="tmd-pair">
                          <div class="tmd-node">
                            <button type="button" class="tmd-dotbtn ok" aria-pressed="false"></button>
                            <span class="tmd-nlabel">남포</span>
                          </div>
                          <div class="tmd-edge ok" data-state="ok" data-from="남포" data-to="자갈치" data-line="부산역 - 사하"></div>
                        </div>
                
                        <div class="tmd-pair">
                          <div class="tmd-node">
                            <button type="button" class="tmd-dotbtn ok" aria-pressed="false"></button>
                            <span class="tmd-nlabel">자갈치</span>
                          </div>
                          <div class="tmd-edge danger" data-state="danger" data-from="자갈치" data-to="토성" data-line="부산역 - 사하"></div>
                        </div>
                
                        <div class="tmd-pair">
                          <div class="tmd-node">
                            <button type="button" class="tmd-dotbtn danger" aria-pressed="false"></button>
                            <span class="tmd-nlabel">토성</span>
                          </div>
                          <div class="tmd-edge danger" data-state="danger" data-from="토성" data-to="동대신" data-line="부산역 - 사하"></div>
                        </div>
                
                        <div class="tmd-pair">
                          <div class="tmd-node">
                            <button type="button" class="tmd-dotbtn danger" aria-pressed="false"></button>
                            <span class="tmd-nlabel">동대신</span>
                          </div>
                          <div class="tmd-edge warn" data-state="warn" data-from="동대신" data-to="서대신" data-line="부산역 - 사하"></div>
                        </div>
                
                        <div class="tmd-pair">
                          <div class="tmd-node">
                            <button type="button" class="tmd-dotbtn warn" aria-pressed="false"></button>
                            <span class="tmd-nlabel">서대신</span>
                          </div>
                          <div class="tmd-edge warn" data-state="warn" data-from="서대신" data-to="대티" data-line="부산역 - 사하"></div>
                        </div>

                        <div class="tmd-pair">
                          <div class="tmd-node">
                            <button type="button" class="tmd-dotbtn warn" aria-pressed="false"></button>
                            <span class="tmd-nlabel">대티</span>
                          </div>
                          <div class="tmd-edge warn" data-state="warn" data-from="대티" data-to="사하" data-line="부산역 - 사하"></div>
                        </div>

                        <div class="tmd-pair">
                          <div class="tmd-node">
                            <button type="button" class="tmd-dotbtn ok" aria-pressed="false"></button>
                            <span class="tmd-nlabel">괴정</span>
                          </div>
                          <div class="tmd-edge ok" data-state="ok" data-from="괴정" data-to="사하" data-line="부산역 - 사하"></div>
                        </div>
                
                        <!-- 마지막 노드엔 (tmd-pair--last) 클래스 추가 및 tmd-edge 미존재 -->
                        <div class="tmd-pair tmd-pair--last">
                          <div class="tmd-node">
                            <button type="button" class="tmd-dotbtn ok" aria-pressed="false"></button>
                            <span class="tmd-nlabel">사하</span>
                          </div>
                        </div>
                      </div>
                    </div>
                </div>
              </div>
              <div class="tmd-label tmd-to">도착</div>
            </div>

            <div class="tmd-card" data-line="부산 - 동대신">
              <div class="tmd-label tmd-from">출발</div>
              <div class="tmd-route">
                <div class="tmd-track">
                  <div class="tmd-grid">
                      <div class="tmd-row">
                        <!--
                        상태 구분: unknown|ok|warn|danger (미수신|정상|주의|위험)
                        상태 적용: .tmd-dotbtn, .tmd-edge (클래스로 상태 표현)
                        tmd-edge data: data-state, data-from, data-to, data-line (팝오버/로그 메타)
                        마지막 노드엔 (tmd-pair--last) 클래스 추가
                        -->
                        <div class="tmd-pair">
                          <div class="tmd-node">
                            <button type="button" class="tmd-dotbtn danger" aria-pressed="false"></button>
                            <span class="tmd-nlabel">부산역</span>
                          </div>
                          <div class="tmd-edge danger" data-state="danger" data-from="부산역" data-to="중앙" data-line="부산역 - 대티"></div>
                        </div>
                
                        <div class="tmd-pair">
                          <div class="tmd-node">
                            <button type="button" class="tmd-dotbtn danger" aria-pressed="false"></button>
                            <span class="tmd-nlabel">중앙</span>
                          </div>
                          <div class="tmd-edge warn" data-state="warn" data-from="중앙" data-to="남포" data-line="부산역 - 대티"></div>
                        </div>
                
                        <div class="tmd-pair">
                          <div class="tmd-node">
                            <button type="button" class="tmd-dotbtn warn" aria-pressed="false"></button>
                            <span class="tmd-nlabel">남포</span>
                          </div>
                          <div class="tmd-edge warn" data-state="warn" data-from="남포" data-to="자갈치" data-line="부산역 - 대티"></div>
                        </div>
                
                        <div class="tmd-pair">
                          <div class="tmd-node">
                            <button type="button" class="tmd-dotbtn warn" aria-pressed="false"></button>
                            <span class="tmd-nlabel">자갈치</span>
                          </div>
                          <div class="tmd-edge danger" data-state="danger" data-from="자갈치" data-to="토성" data-line="부산역 - 대티"></div>
                        </div>
                
                        <div class="tmd-pair">
                          <div class="tmd-node">
                            <button type="button" class="tmd-dotbtn danger" aria-pressed="false"></button>
                            <span class="tmd-nlabel">토성</span>
                          </div>
                          <div class="tmd-edge danger" data-state="danger" data-from="토성" data-to="동대신" data-line="부산역 - 대티"></div>
                        </div>
                
                        <div class="tmd-pair">
                          <div class="tmd-node">
                            <button type="button" class="tmd-dotbtn danger" aria-pressed="false"></button>
                            <span class="tmd-nlabel">동대신</span>
                          </div>
                          <div class="tmd-edge warn" data-state="warn" data-from="동대신" data-to="서대신" data-line="부산역 - 대티"></div>
                        </div>
                
                        <div class="tmd-pair">
                          <div class="tmd-node">
                            <button type="button" class="tmd-dotbtn unknown" aria-pressed="false"></button>
                            <span class="tmd-nlabel">서대신</span>
                          </div>
                          <div class="tmd-edge unknown" data-state="unknown" data-from="서대신" data-to="대티" data-line="부산역 - 대티"></div>
                        </div>

                        <!-- 마지막 노드엔 (tmd-pair--last) 클래스 추가 및 tmd-edge 미존재 -->
                        <div class="tmd-pair tmd-pair--last">
                          <div class="tmd-node">
                            <button type="button" class="tmd-dotbtn unknown" aria-pressed="false"></button>
                            <span class="tmd-nlabel">대티</span>
                          </div>
                        </div>
                      </div>
                    </div>
                </div>
              </div>
              <div class="tmd-label tmd-to">도착</div>
            </div>

            <div class="tmd-card" data-line="부산 - 서대신">
              <div class="tmd-label tmd-from">출발</div>
              <div class="tmd-route">
                <div class="tmd-track">
                  <div class="tmd-grid">
                    <div class="tmd-row">
                      <!--
                      상태 구분: unknown|ok|warn|danger (미수신|정상|주의|위험)
                      상태 적용: .tmd-dotbtn, .tmd-edge (클래스로 상태 표현)
                      tmd-edge data: data-state, data-from, data-to, data-line (팝오버/로그 메타)
                      마지막 노드엔 (tmd-pair--last) 클래스 추가
                      -->
                      <div class="tmd-pair">
                        <div class="tmd-node">
                          <button type="button" class="tmd-dotbtn ok" aria-pressed="false"></button>
                          <span class="tmd-nlabel">부산역</span>
                        </div>
                        <div class="tmd-edge ok" data-state="ok" data-from="부산역" data-to="중앙" data-line="부산역 - 괴정"></div>
                      </div>
              
                      <div class="tmd-pair">
                        <div class="tmd-node">
                          <button type="button" class="tmd-dotbtn ok" aria-pressed="false"></button>
                          <span class="tmd-nlabel">중앙</span>
                        </div>
                        <div class="tmd-edge ok" data-state="ok" data-from="중앙" data-to="남포" data-line="부산역 - 괴정"></div>
                      </div>
              
                      <div class="tmd-pair">
                        <div class="tmd-node">
                          <button type="button" class="tmd-dotbtn ok" aria-pressed="false"></button>
                          <span class="tmd-nlabel">남포</span>
                        </div>
                        <div class="tmd-edge ok" data-state="ok" data-from="남포" data-to="자갈치" data-line="부산역 - 괴정"></div>
                      </div>
              
                      <div class="tmd-pair">
                        <div class="tmd-node">
                          <button type="button" class="tmd-dotbtn unknown" aria-pressed="false"></button>
                          <span class="tmd-nlabel">자갈치</span>
                        </div>
                        <div class="tmd-edge unknown" data-state="unknown" data-from="자갈치" data-to="토성" data-line="부산역 - 괴정"></div>
                      </div>
              
                      <div class="tmd-pair">
                        <div class="tmd-node">
                          <button type="button" class="tmd-dotbtn unknown" aria-pressed="false"></button>
                          <span class="tmd-nlabel">토성</span>
                        </div>
                        <div class="tmd-edge unknown" data-state="unknown" data-from="토성" data-to="동대신" data-line="부산역 - 괴정"></div>
                      </div>
              
                      <div class="tmd-pair">
                        <div class="tmd-node">
                          <button type="button" class="tmd-dotbtn warn" aria-pressed="false"></button>
                          <span class="tmd-nlabel">동대신</span>
                        </div>
                        <div class="tmd-edge warn" data-state="warn" data-from="동대신" data-to="서대신" data-line="부산역 - 괴정"></div>
                      </div>
              
                      <div class="tmd-pair">
                        <div class="tmd-node">
                          <button type="button" class="tmd-dotbtn warn" aria-pressed="false"></button>
                          <span class="tmd-nlabel">서대신</span>
                        </div>
                        <div class="tmd-edge warn" data-state="warn" data-from="서대신" data-to="대티" data-line="부산역 - 괴정"></div>
                      </div>

                      <div class="tmd-pair">
                        <div class="tmd-node">
                          <button type="button" class="tmd-dotbtn warn" aria-pressed="false"></button>
                          <span class="tmd-nlabel">대티</span>
                        </div>
                        <div class="tmd-edge ok" data-state="ok" data-from="대티" data-to="괴정" data-line="부산역 - 괴정"></div>
                      </div>
              
                      <!-- 마지막 노드엔 (tmd-pair--last) 클래스 추가 및 tmd-edge 미존재 -->
                      <div class="tmd-pair tmd-pair--last">
                        <div class="tmd-node">
                          <button type="button" class="tmd-dotbtn ok" aria-pressed="false"></button>
                          <span class="tmd-nlabel">괴정</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="tmd-label tmd-to">도착</div>
            </div>

            <div class="tmd-card" data-line="부산 - 괴정">
              <div class="tmd-label tmd-from">출발</div>
              <div class="tmd-route">
                <div class="tmd-track">
                  <div class="tmd-grid">
                    <div class="tmd-row">
                      <!--
                      상태 구분: unknown|ok|warn|danger (미수신|정상|주의|위험)
                      상태 적용: .tmd-dotbtn, .tmd-edge (클래스로 상태 표현)
                      tmd-edge data: data-state, data-from, data-to, data-line (팝오버/로그 메타)
                      마지막 노드엔 (tmd-pair--last) 클래스 추가
                      -->
                      <div class="tmd-pair">
                        <div class="tmd-node">
                          <button type="button" class="tmd-dotbtn warn" aria-pressed="false"></button>
                          <span class="tmd-nlabel">부산역</span>
                        </div>
                        <div class="tmd-edge warn" data-state="warn" data-from="부산역" data-to="중앙" data-line="부산역 - 동대신"></div>
                      </div>
              
                      <div class="tmd-pair">
                        <div class="tmd-node">
                          <button type="button" class="tmd-dotbtn warn" aria-pressed="false"></button>
                          <span class="tmd-nlabel">중앙</span>
                        </div>
                        <div class="tmd-edge warn" data-state="warn" data-from="중앙" data-to="남포" data-line="부산역 - 동대신"></div>
                      </div>
              
                      <div class="tmd-pair">
                        <div class="tmd-node">
                          <button type="button" class="tmd-dotbtn ok" aria-pressed="false"></button>
                          <span class="tmd-nlabel">남포</span>
                        </div>
                        <div class="tmd-edge ok" data-state="ok" data-from="남포" data-to="자갈치" data-line="부산역 - 동대신"></div>
                      </div>
              
                      <div class="tmd-pair">
                        <div class="tmd-node">
                          <button type="button" class="tmd-dotbtn unknown" aria-pressed="false"></button>
                          <span class="tmd-nlabel">자갈치</span>
                        </div>
                        <div class="tmd-edge unknown" data-state="unknown" data-from="자갈치" data-to="토성" data-line="부산역 - 동대신"></div>
                      </div>
              
                      <div class="tmd-pair">
                        <div class="tmd-node">
                          <button type="button" class="tmd-dotbtn unknown" aria-pressed="false"></button>
                          <span class="tmd-nlabel">토성</span>
                        </div>
                        <div class="tmd-edge ok" data-state="ok" data-from="토성" data-to="동대신" data-line="부산역 - 동대신"></div>
                      </div>
              
                      <!-- 마지막 노드엔 (tmd-pair--last) 클래스 추가 및 tmd-edge 미존재 -->
                      <div class="tmd-pair tmd-pair--last">
                        <div class="tmd-node">
                          <button type="button" class="tmd-dotbtn ok" aria-pressed="false"></button>
                          <span class="tmd-nlabel">동대신</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="tmd-label tmd-to">도착</div>
            </div>
          </div>

          <div class="tmd-side">
            <div class="tmd-panel" aria-live="polite">
              <h3>센서 기본값</h3>
              <dl class="tmd-kv">
                <dt>노선</dt><dd id="tmd-d-line">부산→동대신</dd>
                <dt>구간</dt><dd id="tmd-d-seg">부산역</dd>
                <dt>최근 측정</dt><dd id="tmd-d-last">2025. 9. 10. 오후 5:29:07</dd>
                <dt>ID</dt><dd id="tmd-d-id">S-0001</dd>
                <dt>Nickname</dt><dd id="tmd-d-nick">센서A</dd>
                <dt>Device ID</dt><dd id="tmd-d-device">DEV-42</dd>
                <dt>Tension Type</dt><dd id="tmd-d-type">Spring</dd>
                <dt>범위(S/L/C/NI)</dt><dd id="tmd-d-range">12 / 34 / 5 / 3</dd>
                <dt>변위(Min/Max)</dt><dd id="tmd-d-disp">0.1 / 1.5</dd>
                <dt>온도(Min/Max)</dt><dd id="tmd-d-temp">-10 / 60</dd>
                <dt>전압(Node/Gate)</dt><dd id="tmd-d-volt">4.2 / 12</dd>
                <dt>데이터(최근/범위밖)</dt><dd id="tmd-d-count">128 / 2</dd>
              </dl>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Popover -->
  <div class="tmd-popover" id="tmd-popover" hidden>
    <div class="tmd-sheet" role="dialog" aria-modal="false" aria-labelledby="tmd-p-title">
      <div class="thd-shhet-header">
        <h3 id="tmd-p-title" class="tmd-p-title">센서 기본값</h3>
        <button class="tmd-close" id="tmd-p-close" aria-label="닫기">✕</button>
      </div>
      <dl class="tmd-kv">
        <dt>노선</dt><dd id="tmd-p-line">-</dd>
        <dt>구간</dt><dd id="tmd-p-seg">-</dd>
        <dt>상태</dt><dd id="tmd-p-state">-</dd>
        <dt>최근 측정</dt><dd id="tmd-p-last">-</dd>
        <dt>ID</dt><dd id="tmd-p-id">-</dd>
        <dt>Nickname</dt><dd id="tmd-p-nick">-</dd>
        <dt>Device ID</dt><dd id="tmd-p-device">-</dd>
        <dt>Tension Type</dt><dd id="tmd-p-type">-</dd>
      </dl>
    </div>
  </div>

  <!-- libs -->
  <script src="js/jquery-3.1.1.min.js"></script>
  <script src="js/popper.min.js"></script>
  <script src="js/bootstrap.js"></script>
  <script src="js/plugins/metisMenu/jquery.metisMenu.js"></script>
  <script src="js/plugins/slimscroll/jquery.slimscroll.min.js"></script>
  <script src="js/inspinia.js"></script>
  <script src="js/plugins/pace/pace.min.js"></script>
  <script src="js/plugins/jquery-ui/jquery-ui.min.js"></script>

  <!-- Page scripts -->
  <script>
    /* Theme / Popover / SidePanel / Clock */
    (function (win, doc, $) {
      var TMD = win.TMD || {}; win.TMD = TMD;

      /* =========================
        Theme Module
      ========================= */
      TMD.Theme = (function(){
        var KEY = 'tmd-theme';
        function setTheme(t){
          $('body').attr('data-theme', t);
          try{ localStorage.setItem(KEY, t); }catch(e){}
          var $btn = $('#tmd-theme-toggle');
          if(!$btn.length) return;
          var isDark = (t === 'dark');
          $btn.attr('aria-pressed', String(isDark));
          var $icon = $btn.find('i');
          if($icon.length) $icon.attr('class', isDark ? 'fa fa-sun-o' : 'fa fa-moon-o');
        }
        function loadTheme(){
          var t=null; try{ t = localStorage.getItem(KEY); }catch(e){}
          if(!t) t = $('body').attr('data-theme') || 'light';
          setTheme(t);
        }
        function toggleTheme(){
          var cur = ($('body').attr('data-theme') === 'dark') ? 'dark' : 'light';
          setTheme(cur === 'dark' ? 'light' : 'dark');
        }
        function init(btnSel){
          loadTheme();
          $(doc).on('click', btnSel || '#tmd-theme-toggle', toggleTheme);
        }
        return { setTheme:setTheme, loadTheme:loadTheme, toggleTheme:toggleTheme, init:init };
      })();

      /* =========================
        Popover Module
        - 상태 표시는 요소의 상태 클래스(.ok|.warn|.danger|.unknown)만을 기준으로 함
        - .tmd-edge data-* (data-state, data-from, data-to, data-line)는 팝오버/로그용 보조 메타
      ========================= */
      TMD.Popover = (function(){
        var $pop, $sheet, lockMode=false, anchorEl=null, anchorPayload=null;

        function labelOf(s){ return s==='ok'?'정상' : s==='warn'?'주의' : s==='danger'?'위험' : '미수신'; }
        function stateFromClass(el){
          if(!el) return 'unknown';
          var $el = $(el);
          if($el.hasClass('danger')) return 'danger';
          if($el.hasClass('warn'))   return 'warn';
          if($el.hasClass('ok'))     return 'ok';
          return 'unknown';
        }
        function getEdgePayload($edge){
          var $card = $edge.closest('.tmd-card');
          return {
            line : $edge.data('line') || ($card.length ? $card.data('line') : '-') || '-',
            from : $edge.data('from') || '-',
            to   : $edge.data('to')   || '-',
            state: $edge.data('state') || stateFromClass($edge[0])
          };
        }

        function fill(data){
          $('#tmd-p-line').text(data.line || '-');
          $('#tmd-p-seg').text(data.segment || (data.from ? (data.from+' → '+data.to) : '-'));
          $('#tmd-p-state').text(labelOf(data.state));
          $('#tmd-p-last').text(data.last || new Date().toLocaleString());
          // 데모 필드(실데이터 연동 시 교체)
          $('#tmd-p-id').text('S-0001'); $('#tmd-p-nick').text('센서A');
          $('#tmd-p-device').text('DEV-42'); $('#tmd-p-type').text('Spring');
        }
        function openAt(x,y,payload){
          fill(payload);
          $pop.prop('hidden', false);
          $sheet.css({ top: Math.max(12, y+10), left: Math.min($(win).width()-300, x+12) });
        }
        function openByAnchor(anchor,payload){
          fill(payload);
          var r = anchor.getBoundingClientRect();
          $pop.prop('hidden', false);
          $sheet.css({ top: Math.max(12, r.top-6), left: Math.min($(win).width()-300, r.left + r.width + 10) });
        }
        function saveAnchor(anchor,payload){ anchorEl = anchor; anchorPayload = payload; lockMode = true; }
        function restoreAnchor(){ if(lockMode && anchorEl) openByAnchor(anchorEl, anchorPayload); }
        function close(){ lockMode=false; anchorEl=null; anchorPayload=null; $pop.prop('hidden', true); }

        function bind(){
          // 엣지: hover/이동/leave/클릭
          $(doc)
           .on('mouseenter', '.tmd-edge', function(e){ 
              // [옵션] 고정 중(edge hover) 팝오버 닫기 → 필요하면 주석 해제
              // if (lockMode) return close();
              openAt(e.clientX, e.clientY, getEdgePayload($(this))); 
            })
            .on('mousemove',  '.tmd-edge', function(e){
              if($pop.prop('hidden')) return;
              $sheet.css({ top: e.clientY+10, left: Math.min($(win).width()-300, e.clientX+12) });
            })
            .on('mouseleave', '.tmd-edge', function(){ if(lockMode) restoreAnchor(); else $pop.prop('hidden', true); })
            .on('click',      '.tmd-edge', function(e){ openAt(e.clientX, e.clientY, getEdgePayload($(this))); });

          // 노드: 클릭 → 고정모드
          $(doc).on('click', '.tmd-node', function(){
            var $node = $(this), $btn = $node.find('.tmd-dotbtn');
            var seg   = $.trim($node.find('.tmd-nlabel').text());
            var line  = $node.closest('.tmd-card').data('line') || '-';
            var m = ($btn.attr('class')||'').match(/\b(ok|warn|danger|unknown)\b/);
            var state = (m && m[1]) ? m[1] : 'unknown';
            var payload = { line: line, segment: seg, state: state, last: new Date().toLocaleString() };
            saveAnchor($btn[0] || this, payload);
            openByAnchor(anchorEl, anchorPayload);
          });

          // 닫기
          $(doc).on('click', '#tmd-p-close', close);
          $(doc).on('keydown', function(e){ if(e.key==='Escape') close(); });
          $(doc).on('mousedown', function(e){
            if(!$pop.prop('hidden') && !$sheet[0].contains(e.target)) close();
          });
        }

        function init(){
          $pop = $('#tmd-popover'); $sheet = $pop.find('.tmd-sheet');
          bind();
        }
        return { init:init, openAt:openAt, openByAnchor:openByAnchor, close:close };
      })();

      /* =========================
        Side Panel Module
      ========================= */
      TMD.SidePanel = (function(){
        function sampleSensor(){ return { id:'S-0001', nick:'센서A', device:'DEV-42', type:'Spring', range:'12 / 34 / 5 / 3', disp:'0.1 / 1.5', temp:'-10 / 60', volt:'4.2 / 12', count:'128 / 2' }; }
        function fill(payload, sensor){
          if(!payload) return;
          $('#tmd-d-line').text(payload.line || '-');
          $('#tmd-d-seg').text(payload.segment || (payload.from ? (payload.from+' → '+payload.to) : '-'));
          $('#tmd-d-last').text(new Date().toLocaleString());
          var s = sensor || sampleSensor();
          $('#tmd-d-id').text(s.id);
          $('#tmd-d-nick').text(s.nick);
          $('#tmd-d-device').text(s.device);
          $('#tmd-d-type').text(s.type);
          $('#tmd-d-range').text(s.range);
          $('#tmd-d-disp').text(s.disp);
          $('#tmd-d-temp').text(s.temp);
          $('#tmd-d-volt').text(s.volt);
          $('#tmd-d-count').text(s.count);
        }
        function edgePayload($edge){
          var $card = $edge.closest('.tmd-card');
          return {
            line: $edge.data('line') || ($card.length ? $card.data('line') : '-') || '-',
            from: $edge.data('from') || '-',
            to  : $edge.data('to')   || '-'
          };
        }
        function bind(){
          if (!$('.tmd-side .tmd-panel').length) return;
          $(doc)
            .on('mouseenter', '.tmd-edge', function(){ fill(edgePayload($(this))); })
            .on('click',      '.tmd-edge', function(){ fill(edgePayload($(this))); })
            .on('click',      '.tmd-node', function(){
              var $node = $(this);
              var seg = $.trim($node.find('.tmd-nlabel').text());
              var line = $node.closest('.tmd-card').data('line') || '-';
              fill({ line: line, segment: seg });
            });
        }
        function init(){ bind(); }
        return { init:init, fill:fill };
      })();

      /* =========================
        Init
      ========================= */
      $(function(){
        TMD.Theme.init('#tmd-theme-toggle');
        TMD.Popover.init();
        TMD.SidePanel.init();

        // Clock: HH:MM:SS (Asia/Seoul)
        (function(){
          var $el = $('#tmd-clock');
          if(!$el.length) return;
          var fmt = new Intl.DateTimeFormat('ko-KR', {
            hour:'2-digit', minute:'2-digit', second:'2-digit',
            hour12:false, timeZone: 'Asia/Seoul'
          });
          function tick(){ $el.text(fmt.format(new Date())); }
          tick();
          win.setInterval(tick, 1000);
        })();
      });

    })(window, document, jQuery);
  </script>
</body>
</html>